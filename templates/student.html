<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard - Gate Pass</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{
            background:#0f0f23;
            color:white;
            font-family:Inter, sans-serif;
        }
        .container{max-width:1200px;margin:auto;padding:30px}
        textarea,input,button{
            width:100%;
            padding:12px;
            margin-top:10px;
            border-radius:8px;
            border:none;
        }
        button{
            background:#667eea;
            color:white;
            font-weight:700;
            cursor:pointer;
        }
        .card{
            background:rgba(255,255,255,.05);
            padding:25px;
            border-radius:16px;
            margin-bottom:30px;
        }
        .otp-notice{
            background:#2e7d32;
            padding:12px;
            border-radius:8px;
            margin-bottom:10px;
        }
        table{
            width:100%;
            border-collapse:collapse;
        }
        th,td{
            padding:12px;
            border-bottom:1px solid rgba(255,255,255,.2);
        }
        .qr-img{
            width:100px;
            background:white;
            padding:4px;
            border-radius:8px;
        }
        .status-pending{color:orange}
        .status-approved{color:#4caf50}
        .status-rejected{color:red}
    </style>
</head>
<body>

<div class="container">

<h2>Welcome, {{ student_name }}</h2>

<div class="card">
<h3>Request Gate Pass</h3>

<form method="POST">

{% if not otp_required %}
    <textarea name="reason" placeholder="Reason for leave" required></textarea>
    <input type="date" name="out_date" required>
    <input type="time" name="out_time" required>
    <button type="submit">SEND OTP</button>
{% else %}
    <div class="otp-notice">
        OTP sent to parent's mobile number
    </div>
    <input type="text" name="otp" placeholder="Enter OTP" required maxlength="6">
    <button type="submit">VERIFY & SUBMIT</button>
{% endif %}

</form>
</div>

<div class="card">
<h3>Request History</h3>

{% if requests_list %}
<table>
<thead>
<tr>
<th>#</th>
<th>Reason</th>
<th>Date</th>
<th>Time</th>
<th>Status</th>
<th>QR</th>
</tr>
</thead>
<tbody>

{% for r in requests_list %}
<tr>
<td>{{ loop.index }}</td>
<td>{{ r.reason }}</td>
<td>{{ r.out_date }}</td>
<td>{{ r.out_time }}</td>
<td class="status-{{ r.status.lower() }}">{{ r.status }}</td>
<td>
{% if r.qr_code_data %}
<img class="qr-img" src="data:image/png;base64,{{ r.qr_code_data }}">
{% else %}
â€”
{% endif %}
</td>
</tr>
{% endfor %}

</tbody>
</table>
{% else %}
<p>No requests yet</p>
{% endif %}
</div>

<a href="{{ url_for('logout') }}">Logout</a>

</div>
</body>
</html>

